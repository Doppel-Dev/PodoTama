@page "/profesionales"
@using PodoTama.Application.DTOs
@using PodoTama.UI.Components
@using PodoTama.UI.Models
@using PodoTama.UI.Services
@inject ProfesionalService ProfesionalService
@inject NavigationManager NavigationManager
@inject IJSRuntime JS


<Titulo Text="Profesionales" Level="1" Center="true" FontSize="42px" Color="black" CssClass="title-center title-shadow" />

<div class="mb-3" style="padding: 5px">
    <button class="btn btn-success" @onclick="AgregarProfesional">
        <i class="bi bi-person-plus"></i> Agregar Profesional
    </button>
</div>

<div style="padding: 5px">
    <Tables TItem="ProfesionalDTO" Items="Profesional2" Columns="GetColumnas()" />
</div>

@code {
    private List<ProfesionalDTO> Profesional2 = new();

    protected override async Task OnInitializedAsync()
    {
        Profesional2 = await ProfesionalService.GetAllAsync();
    }

    private void AgregarProfesional()
    {
        NavigationManager.NavigateTo("/profesional/crear");
    }

    private List<TableModel<ProfesionalDTO>> GetColumnas()
    {
        return new()
            {
                new() { Title = "Nombre", Template = p => @<strong>@p.Nombre</strong> },
                new() { Title = "Especialidad", Template = p => @<span>@p.Especialidad</span> },
                new() { Title = "Telefono", Template = p => @<span>@p.Telefono</span> },
                new() { Title = "Email", Template = p => @<span>@p.Email</span> },
                new()
                {
                    Title = "Acciones",
                    Template = p => @<div>
                    <a class="btn btn-primary btn-sm me-1" href="@($"/profesional/detalles/{p.IdProfesional}")">
                    <i class="bi bi-eye"></i>
                    </a>
                    <a class="btn btn-info btn-sm me-1" href="@($"/profesional/editar/{p.IdProfesional}")">
                    <i class="bi bi-pencil"></i>
                    </a>
                    <a class="btn btn-danger btn-sm" @onclick="() => ConfirmarEliminar(p.IdProfesional)">
                    <i class="bi bi-trash"></i>
                    </a>
                    </div>
                }
            };
        }


    private async Task ConfirmarEliminar(int id)
    {
        var result = await JS.InvokeAsync<object>("Swal.fire", new
        {
            title = "¿Estás seguro?",
            text = "Esta acción eliminará al profesional de forma permanente.",
            icon = "warning",
            showCancelButton = true,
            confirmButtonColor = "#d33",
            cancelButtonColor = "#3085d6",
            confirmButtonText = "Sí, eliminar",
            cancelButtonText = "Cancelar"
        });

        var json = (System.Text.Json.JsonElement)result;
        bool confirmado = json.GetProperty("isConfirmed").GetBoolean();

        if (confirmado)
        {
            var ok = await ProfesionalService.DeleteAsync(id);
            if (ok)
            {
                Profesional2 = await ProfesionalService.GetAllAsync();
                StateHasChanged();

                await JS.InvokeVoidAsync("Swal.fire", new
                {
                    title = "Eliminado",
                    text = "El profesional fue eliminado correctamente.",
                    icon = "success"
                });
            }
            else
            {
                await JS.InvokeVoidAsync("Swal.fire", new
                {
                    title = "Error",
                    text = "No se pudo eliminar el profesional.",
                    icon = "error"
                });
            }
        }
    }


}

<style>
    .title-center {
        display: block;
        width: 100%;
        text-align: center;
        margin: 0 auto;
    }

</style>